<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APL SHyST Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ í™”ë©´ -->
    <div id="password-screen" class="password-screen">
        <div class="password-box">
            <h1>ğŸ”’ APL SHyST Calculator</h1>
            <p>ì´ ì‚¬ì´íŠ¸ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³´í˜¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
            <input type="password" id="password-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()">ì ‘ì†</button>
            <p id="password-error" class="password-error"></p>
        </div>
    </div>

    <div class="container" id="main-content" style="display: none;">
        <header>
            <h1>ğŸš€ APL SHyST Calculator</h1>
            <p class="subtitle">í•´ì„í•´ + 1D Euler ì‹œë®¬ë ˆì´ì…˜ (HLLC Solver)</p>
        </header>

        <main>
            <div class="input-section">
                <div class="input-group driver-group">
                    <h2>ğŸ”´ Driver (ê³ ì••ë¶€)</h2>
                    <div class="form-row">
                        <label for="driver-gas">ê°€ìŠ¤ ì¢…ë¥˜</label>
                        <select id="driver-gas" onchange="toggleMixRatio()">
                            <option value="he">Helium (í—¬ë¥¨)</option>
                            <option value="h2">Hydrogen (ìˆ˜ì†Œ)</option>
                            <option value="air">Air (ê³µê¸°)</option>
                            <option value="ar">Argon (ì•„ë¥´ê³¤)</option>
                            <option value="mix" selected>Air/He í˜¼í•©</option>
                        </select>
                    </div>
                    <div class="form-row" id="mix-ratio-row">
                        <label for="he-ratio">He ëª°ë¶„ìœ¨</label>
                        <input type="number" id="he-ratio" value="0.99" min="0" max="1" step="0.01">
                        <span class="unit">(0~1)</span>
                    </div>
                    <div class="form-row">
                        <label for="driver-p">ì••ë ¥</label>
                        <input type="number" id="driver-p" value="120" min="1" step="1">
                        <span class="unit">bar</span>
                    </div>
                    <div class="form-row">
                        <label for="driver-t">ì˜¨ë„</label>
                        <input type="number" id="driver-t" value="400" min="1" step="1">
                        <span class="unit">K</span>
                    </div>
                </div>

                <div class="input-group driven-group">
                    <h2>ğŸ”µ Driven (ì €ì••ë¶€)</h2>
                    <div class="form-row">
                        <label for="driven-gas">ê°€ìŠ¤ ì¢…ë¥˜</label>
                        <select id="driven-gas">
                            <option value="air">Air (ê³µê¸°)</option>
                            <option value="co2">COâ‚‚ (ì´ì‚°í™”íƒ„ì†Œ)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="driven-p">ì••ë ¥</label>
                        <input type="number" id="driven-p" value="1.2" min="0.01" step="0.1">
                        <span class="unit">bar</span>
                    </div>
                    <div class="form-row">
                        <label for="driven-t">ì˜¨ë„</label>
                        <input type="number" id="driven-t" value="300" min="1" step="1">
                        <span class="unit">K</span>
                    </div>
                </div>

                <div class="input-group geometry-group">
                    <h2>ğŸ“ íŠœë¸Œ ì„¤ì •</h2>
                    <div class="form-row">
                        <label for="tube-length">íŠœë¸Œ ê¸¸ì´</label>
                        <input type="number" id="tube-length" value="11.5" min="1" step="0.5">
                        <span class="unit">m</span>
                    </div>
                    <div class="form-row">
                        <label for="diaphragm">ê²©ë§‰ ìœ„ì¹˜</label>
                        <input type="number" id="diaphragm" value="3.0" min="0.1" step="0.1">
                        <span class="unit">m</span>
                    </div>
                    <div class="form-row">
                        <label for="end-time">ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„</label>
                        <input type="number" id="end-time" value="20" min="1" step="1">
                        <span class="unit">ms</span>
                    </div>
                    <div class="form-row">
                        <label for="nx">ê²©ì ìˆ˜</label>
                        <input type="number" id="nx" value="700" min="100" step="100">
                        <span class="unit">cells</span>
                    </div>
                </div>

                <div class="input-group nozzle-settings">
                    <h2>ğŸ”· ë…¸ì¦ íŒ½ì°½ (State 7)</h2>
                    <div class="form-row">
                        <label for="nozzle-mach">íŒ½ì°½ í›„ ë§ˆí•˜ìˆ˜</label>
                        <input type="number" id="nozzle-mach" value="6.76" min="1.0" step="0.01">
                        <span class="unit">Mâ‚‡</span>
                    </div>
                </div>

                <div class="input-group solver-settings">
                    <h2>âš™ï¸ ìˆ˜ë ´ ì„¤ì •</h2>
                    <div class="form-row">
                        <label for="initial-mach">ì´ˆê¸° ë§ˆí•˜ìˆ˜</label>
                        <input type="number" id="initial-mach" value="3.0" min="1.1" step="0.5">
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculate()">
                    ğŸ”¬ í•´ì„í•´ ê³„ì‚°
                </button>
                
                <button class="simulate-btn" onclick="runSimulation()">
                    â–¶ï¸ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
                </button>
                
                
                <button class="flow-condition-btn" onclick="openFlowConditionFinder()">
                    ğŸ”¬ í…Œì¼ëŸ¬ë“œ ìœ ë™ì¡°ê±´ ì‚°ì¶œê¸°
                </button>
            </div>

            <div class="output-section">
                <!-- í•´ì„í•´ ê³„ì‚° ê²°ê³¼ -->
                <h2>ğŸ“Š í•´ì„í•´ ê²°ê³¼ (Analytic Solution)</h2>
                <div id="convergence-info" class="convergence-info"></div>
                <div id="results" class="results-grid">
                    <p class="placeholder">ì…ë ¥ê°’ì„ ì„¤ì •í•˜ê³  "í•´ì„í•´ ê³„ì‚°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
                
                <!-- í…Œì¼ëŸ¬ë“œ ë¶„ì„ ê²°ê³¼ (ê²°ê³¼ ê·¸ë¦¬ë“œ ì•ˆì— í‘œì‹œ) -->
                <div id="tailored-section" class="tailored-section-inline" style="display: none;">
                    <h3 class="tailored-inline-title">ğŸ¯ í…Œì¼ëŸ¬ë“œ ì¡°ê±´ ë¶„ì„ (Zâ‚‚ â‰ˆ Zâ‚ƒ)</h3>
                    <div id="tailored-result" class="tailored-result"></div>
                </div>
                
                <!-- ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ -->
                <div id="simulation-section" class="simulation-section" style="display: none;">
                    <h2>ğŸ¬ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ (1D Euler - HLLC)</h2>
                    
                    <!-- ì§„í–‰ ìƒíƒœ -->
                    <div id="sim-progress" class="sim-progress" style="display: none;">
                        <div class="progress-container">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <div class="progress-text" id="progress-text">ì‹œë®¬ë ˆì´ì…˜ ì¤€ë¹„ ì¤‘...</div>
                        <div class="progress-details">
                            <span id="progress-time">t = 0.00 ms</span>
                            <span id="progress-remaining">ë‚¨ì€ ì‹œê°„: ê³„ì‚° ì¤‘...</span>
                        </div>
                    </div>
                    
                    <!-- ì‹œë®¬ë ˆì´ì…˜ GIFë“¤ -->
                    <div id="sim-results" class="sim-results" style="display: none;">
                        <div class="sim-grid">
                            <!-- ë©”ì¸ ì‹œë®¬ë ˆì´ì…˜ GIF -->
                            <div class="sim-card main-gif">
                                <h3>ğŸ“ˆ ì‹œë®¬ë ˆì´ì…˜ ì• ë‹ˆë©”ì´ì…˜</h3>
                                <div class="gif-container">
                                    <canvas id="sim-gif-canvas" width="800" height="500"></canvas>
                                </div>
                                <div class="gif-controls">
                                    <button onclick="toggleGifPlay()" id="gif-play-btn">â¸ï¸ ì¼ì‹œì •ì§€</button>
                                    <button onclick="resetGif()">ğŸ”„ ì²˜ìŒë¶€í„°</button>
                                    <span id="gif-frame-info">Frame: 0 / 0</span>
                                </div>
                                <div class="timeline-container">
                                    <span class="timeline-label">t = <span id="timeline-time">0.00</span> ms</span>
                                    <input type="range" id="timeline-slider" min="0" max="100" value="0" 
                                           oninput="onTimelineChange(this.value)">
                                </div>
                            </div>
                            
                            <!-- x-t ë‹¤ì´ì–´ê·¸ë¨ -->
                            <div class="sim-card xt-diagram">
                                <h3>ğŸ—ºï¸ x-t ë‹¤ì´ì–´ê·¸ë¨</h3>
                                <canvas id="xt-canvas" width="900" height="1200"></canvas>
                            </div>
                            
                            <!-- ë²½ë©´ íˆìŠ¤í† ë¦¬ -->
                            <div class="sim-card wall-history">
                                <h3>ğŸ“Š ëì  (x = L) ì‹œê°„ ì´ë ¥</h3>
                                <canvas id="wall-canvas" width="1200" height="1000"></canvas>
                                <button class="test-time-btn" onclick="openTestTimeSelector()">
                                    â±ï¸ ì‹œí—˜ì‹œê°„ ì„ íƒí•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ìµœì  ì¡°ì„± íƒìƒ‰ ê²°ê³¼ -->
            </div>
        </main>

        <footer>
            <p>SNU Hypersonic Shock Tunnel Calculator</p>
            <p class="ref">í•´ì„í•´ + 1D Euler ì‹œë®¬ë ˆì´ì…˜ | HLLC Riemann Solver</p>
            <p class="credits">
                Web Application by <strong>Jungmu Hur</strong> | 1D Simulation Code by <strong>Hyunseob Lee</strong>
            </p>
            <p class="institution">
                Aerospace Propulsion Laboratory, Seoul National University
            </p>
        </footer>
    </div>

    <!-- í…Œì¼ëŸ¬ë“œ ìœ ë™ì¡°ê±´ ì‚°ì¶œê¸° ëª¨ë‹¬ -->
    <div id="flow-condition-modal" class="modal" style="display: none;">
        <div class="modal-content flow-condition-modal-content">
            <div class="modal-header">
                <h2>ğŸ”¬ í…Œì¼ëŸ¬ë“œ ìœ ë™ì¡°ê±´ ì‚°ì¶œê¸°</h2>
                <button class="modal-close" onclick="closeFlowConditionFinder()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="flow-condition-grid-3col">
                    <!-- ì…ë ¥ ì„¹ì…˜ -->
                    <div class="fc-input-section fc-compact">
                        <h3>ğŸ¯ ëª©í‘œ ìœ ë™ì¡°ê±´ (State 7)</h3>
                        
                        <div class="fc-form-row">
                            <label>ëª©í‘œ ë§ˆí•˜ìˆ˜ Mâ‚‡</label>
                            <input type="number" id="fc-target-mach" value="6.76" min="1" step="0.5">
                        </div>
                        
                        <div class="fc-form-row range-row">
                            <label>ë‹¨ìœ„ ë ˆì´ë†€ì¦ˆìˆ˜ Re/m</label>
                            <div class="range-inputs">
                                <input type="number" id="fc-re-min" value="2" min="0.1" step="0.5">
                                <span>~</span>
                                <input type="number" id="fc-re-max" value="12" min="0.1" step="0.5">
                                <span class="unit">Ã—10â¶/m</span>
                            </div>
                        </div>
                        
                        <div class="fc-form-row range-row">
                            <label>í† íƒˆ ì—”íƒˆí”¼ h_tot</label>
                            <div class="range-inputs">
                                <input type="number" id="fc-h-min" value="0.7" min="0.1" step="0.1">
                                <span>~</span>
                                <input type="number" id="fc-h-max" value="2.0" min="0.1" step="0.1">
                                <span class="unit">MJ/kg</span>
                            </div>
                        </div>
                        
                        <div class="fc-divider"></div>
                        
                        <h3>ğŸ“¦ ì¡°ê±´ ì„¤ì •</h3>
                        
                        <div class="fc-form-row">
                            <label>Driven ê°€ìŠ¤</label>
                            <select id="fc-driven-gas">
                                <option value="air">Air (ê³µê¸°)</option>
                                <option value="co2">COâ‚‚ (ì´ì‚°í™”íƒ„ì†Œ)</option>
                            </select>
                        </div>
                        
                        <div class="fc-form-row">
                            <label>Driven ì˜¨ë„ Tâ‚</label>
                            <input type="number" id="fc-t1" value="300" min="200" step="10">
                            <span class="unit">K</span>
                        </div>
                        
                        <div class="fc-form-row">
                            <label>Driver ì˜¨ë„ Tâ‚„</label>
                            <input type="number" id="fc-t4" value="350" min="200" step="10">
                            <span class="unit">K</span>
                        </div>
                        
                        <div class="fc-divider"></div>
                        
                        <h3>ğŸ”§ ì¶”ê°€ ì„¤ì •</h3>
                        
                        <div class="fc-checkbox-row">
                            <input type="checkbox" id="fc-exp-constraint">
                            <label for="fc-exp-constraint">
                                ë“œë¼ì´ë²„ ê°€ì•• ì œì•½ (1bar Air)<br>
                                <span class="fc-hint">Air 1bar ê³ ì • í›„ He ê°€ì••</span>
                            </label>
                        </div>
                        
                        <div class="fc-checkbox-row">
                            <input type="checkbox" id="fc-auto-t4" checked>
                            <label for="fc-auto-t4">
                                Driver ì˜¨ë„ ìë™ ì¶”ì •<br>
                                <span class="fc-hint">Tâ‚„ â‰ˆ 300 + 0.8Ã—(pâ‚„-1) K</span>
                            </label>
                        </div>
                        
                        <button class="fc-calculate-btn" onclick="calculateFlowCondition()">
                            ğŸ” ì¡°ê±´ íƒìƒ‰
                        </button>
                    </div>
                    
                    <!-- í•µì‹¬ ê²°ê³¼ -->
                    <div class="fc-result-section fc-compact">
                        <h3>ğŸ“‹ í•µì‹¬ ê²°ê³¼</h3>
                        <div id="fc-key-results" class="fc-key-compact" style="display: none;">
                            <div class="fc-key-item"><span>pâ‚</span><span id="fc-key-p1">-</span><small>bar</small></div>
                            <div class="fc-key-item"><span>Î”p</span><span id="fc-key-diff">-</span><small>bar</small></div>
                        </div>
                        <div id="fc-driver-guide" class="fc-guide-compact" style="display: none;">
                            <div class="fc-guide-title">ğŸ”§ ì¶©ì „ ê°€ì´ë“œ</div>
                            <div class="fc-guide-item"><span>He%</span><span id="fc-guide-he">-</span></div>
                            <div class="fc-guide-item hl"><span>â‘ Air</span><span id="fc-guide-air">-</span></div>
                            <div class="fc-guide-item hl"><span>â‘¡ìµœì¢…</span><span id="fc-guide-final">-</span></div>
                        </div>
                        <div id="fc-sliders" class="fc-sliders-compact" style="display: none;">
                            <div class="fc-slider-item">
                                <span>Re/m: <b id="fc-re-display">7.0</b></span>
                                <input type="range" id="fc-re-slider" min="2" max="12" step="0.01" value="7">
                            </div>
                            <div class="fc-slider-item">
                                <span>h_tot: <b id="fc-h-display">1.35</b></span>
                                <input type="range" id="fc-h-slider" min="0.7" max="2.0" step="0.01" value="1.35">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìƒì„¸ ê²°ê³¼ -->
                    <div class="fc-result-section fc-compact">
                        <h3>ğŸ“Š ìƒì„¸</h3>
                        <div id="fc-result-content" class="fc-result-content">
                            <p class="fc-placeholder">ì¡°ê±´ íƒìƒ‰ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeFlowConditionFinder()">ë‹«ê¸°</button>
                <button class="modal-btn confirm" onclick="applyFlowCondition()">âœ“ ë©”ì¸ì— ì ìš©</button>
            </div>
        </div>
    </div>

    <!-- ì‹œí—˜ì‹œê°„ ì„ íƒ ëª¨ë‹¬ -->
    <div id="test-time-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â±ï¸ ì‹œí—˜ì‹œê°„ ì„ íƒ</h2>
                <button class="modal-close" onclick="closeTestTimeSelector()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="modal-chart-container">
                    <canvas id="test-time-canvas" width="1000" height="400"></canvas>
                </div>
                <p class="modal-instruction">ğŸ–±ï¸ ë…¹ìƒ‰ ì„ ì„ ë“œë˜ê·¸í•˜ì—¬ ì‹œí—˜ ì‹œì‘/ë ì‹œê°„ì„ ì¡°ì ˆí•˜ì„¸ìš”</p>
                <div class="test-time-info">
                    <div class="info-item">
                        <span class="info-label">ì‹œí—˜ì‹œê°„</span>
                        <span class="info-value" id="modal-test-duration">0.00 ms</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">êµ¬ê°„</span>
                        <span class="info-value" id="modal-test-range">0.00 ~ 0.00 ms</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í‰ê·  ì••ë ¥</span>
                        <span class="info-value" id="modal-mean-pressure">0.00 bar</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">CV (Ïƒ/Î¼)</span>
                        <span class="info-value" id="modal-cv">0.00 %</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeTestTimeSelector()">ì·¨ì†Œ</button>
                <button class="modal-btn confirm" onclick="applyTestTime()">âœ“ ì ìš©</button>
            </div>
        </div>
    </div>

    <script>
        // ë¹„ë°€ë²ˆí˜¸ ì²´í¬
        const SITE_PASSWORD = 'apl13041313!';
        
        // ì„¸ì…˜ì—ì„œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        if (sessionStorage.getItem('authenticated') === 'true') {
            document.getElementById('password-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }
        
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            const errorEl = document.getElementById('password-error');
            
            if (input === SITE_PASSWORD) {
                sessionStorage.setItem('authenticated', 'true');
                document.getElementById('password-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            } else {
                errorEl.textContent = 'âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                document.getElementById('password-input').value = '';
            }
        }
    </script>
    <script src="calculator.js"></script>
    <script src="simulator.js"></script>
</body>
</html>

