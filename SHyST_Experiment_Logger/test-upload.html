<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>파일 업로드 테스트</title>
    <script src="xlsx.full.min.js"></script>
</head>
<body>
    <h1>파일 업로드 테스트</h1>
    
    <div style="margin: 20px;">
        <h2>1. XLSX 라이브러리 확인</h2>
        <button onclick="checkXLSX()">XLSX 체크</button>
        <p id="xlsx-status"></p>
    </div>
    
    <div style="margin: 20px;">
        <h2>2. 파일 업로드 테스트</h2>
        <input type="file" id="test-file" accept=".xlsx,.xls" onchange="handleFileUpload(event)">
        <p id="file-status">파일을 선택해주세요</p>
    </div>
    
    <div style="margin: 20px;">
        <h2>3. 콘솔 로그</h2>
        <div id="log" style="border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; font-family: monospace; font-size: 12px;"></div>
    </div>
    
    <script>
        function log(message) {
            console.log(message);
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function checkXLSX() {
            log('=== XLSX 라이브러리 확인 ===');
            log('typeof XLSX: ' + typeof XLSX);
            
            if (typeof XLSX !== 'undefined') {
                log('✅ XLSX 라이브러리 로드 성공!');
                log('XLSX.version: ' + XLSX.version);
                document.getElementById('xlsx-status').textContent = '✅ 로드 성공: ' + XLSX.version;
                document.getElementById('xlsx-status').style.color = 'green';
            } else {
                log('❌ XLSX 라이브러리 로드 실패!');
                document.getElementById('xlsx-status').textContent = '❌ 로드 실패';
                document.getElementById('xlsx-status').style.color = 'red';
            }
        }
        
        async function handleFileUpload(event) {
            log('=== 파일 업로드 시작 ===');
            log('Event: ' + event);
            log('Event.target: ' + event.target);
            log('Event.target.files: ' + event.target.files);
            log('Event.target.files.length: ' + event.target.files.length);
            
            const file = event.target.files[0];
            
            if (!file) {
                log('❌ 파일이 선택되지 않았습니다.');
                document.getElementById('file-status').textContent = '❌ 파일 선택 실패';
                document.getElementById('file-status').style.color = 'red';
                return;
            }
            
            log('✅ 파일 정보:');
            log('  - 이름: ' + file.name);
            log('  - 크기: ' + file.size + ' bytes');
            log('  - 타입: ' + file.type);
            
            document.getElementById('file-status').textContent = '⏳ 로딩 중...';
            document.getElementById('file-status').style.color = 'orange';
            
            try {
                if (typeof XLSX === 'undefined') {
                    throw new Error('XLSX 라이브러리가 로드되지 않았습니다.');
                }
                
                log('⏳ 파일 읽기 시작...');
                const arrayBuffer = await file.arrayBuffer();
                log('✅ ArrayBuffer 크기: ' + arrayBuffer.byteLength + ' bytes');
                
                log('⏳ XLSX 파싱 시작...');
                const workbook = XLSX.read(arrayBuffer);
                log('✅ Workbook 로드 완료!');
                log('  - 시트 수: ' + workbook.SheetNames.length);
                log('  - 시트 이름: ' + workbook.SheetNames.join(', '));
                
                // 첫 번째 시트 읽기
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                log('✅ JSON 변환 완료!');
                log('  - 행 수: ' + jsonData.length);
                log('  - 첫 행: ' + JSON.stringify(jsonData[0]));
                
                document.getElementById('file-status').textContent = '✅ 성공: ' + file.name + ' (' + workbook.SheetNames.length + '개 시트)';
                document.getElementById('file-status').style.color = 'green';
                
            } catch (e) {
                log('❌ 오류 발생: ' + e.message);
                log('Stack: ' + e.stack);
                document.getElementById('file-status').textContent = '❌ 실패: ' + e.message;
                document.getElementById('file-status').style.color = 'red';
            }
        }
        
        // 페이지 로드 시 자동으로 XLSX 체크
        window.addEventListener('load', function() {
            log('=== 페이지 로드 완료 ===');
            checkXLSX();
        });
    </script>
</body>
</html>
